"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const dutyChain_1 = require("./dutyChain");
const utils_1 = require("./utils");
class PageSplicing {
    constructor() {
        this.dutyChains = [];
        this.dutyChains = [];
    }
    get head() {
        return this.dutyChains[0];
    }
    get tail() {
        return this.dutyChains.slice(-1)[0];
    }
    get utils() {
        return {
            pagingLogic: (getData, getCount) => {
                return async (offset, pageSize, next) => {
                    return await utils_1.pagingLogic(getData, getCount, offset, pageSize, next);
                };
            }
        };
    }
    emptyChain() {
        this.dutyChains = [];
    }
    next(handler) {
        const nextChain = new dutyChain_1.default(handler);
        if (this.head) {
            this.head.setNext(nextChain);
        }
        this.dutyChains.push(nextChain);
        return this;
    }
    async start(pageIndex, pageSize) {
        if (!this.tail)
            throw new Error('duty chain is empty!');
        const ret = await this.tail.handleRequest(pageIndex, pageSize);
        return ret;
    }
}
exports.default = new PageSplicing();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQ0FBb0M7QUFDcEMsbUNBQXNDO0FBRXRDLE1BQU0sWUFBWTtJQUVoQjtRQURRLGVBQVUsR0FBZ0IsRUFBRSxDQUFDO1FBRW5DLElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxJQUFZLElBQUk7UUFDZCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVELElBQVksSUFBSTtRQUNkLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNyQyxDQUFDO0lBRUQsSUFBVyxLQUFLO1FBQ2QsT0FBTztZQUNMLFdBQVcsRUFBRSxDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsRUFBRTtnQkFDakMsT0FBTyxLQUFLLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsRUFBRTtvQkFDdEMsT0FBTyxNQUFNLG1CQUFXLENBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFBO2dCQUNyRSxDQUFDLENBQUE7WUFDSCxDQUFDO1NBQ0YsQ0FBQTtJQUNILENBQUM7SUFFTSxVQUFVO1FBQ2YsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUE7SUFDdEIsQ0FBQztJQUVNLElBQUksQ0FBQyxPQUFpQjtRQUMzQixNQUFNLFNBQVMsR0FBRyxJQUFJLG1CQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFekMsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDOUI7UUFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVoQyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFTSxLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxRQUFRO1FBQ3BDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSTtZQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUN4RCxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUUvRCxPQUFPLEdBQUcsQ0FBQTtJQUNaLENBQUM7Q0FDRjtBQUVELGtCQUFlLElBQUksWUFBWSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRHV0eUNoYWluIGZyb20gJy4vZHV0eUNoYWluJztcbmltcG9ydCB7IHBhZ2luZ0xvZ2ljIH0gZnJvbSAnLi91dGlscyc7XG5cbmNsYXNzIFBhZ2VTcGxpY2luZyB7XG4gIHByaXZhdGUgZHV0eUNoYWluczogRHV0eUNoYWluW10gPSBbXTtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5kdXR5Q2hhaW5zID0gW107XG4gIH1cblxuICBwcml2YXRlIGdldCBoZWFkKCkge1xuICAgIHJldHVybiB0aGlzLmR1dHlDaGFpbnNbMF07XG4gIH1cblxuICBwcml2YXRlIGdldCB0YWlsKCkge1xuICAgIHJldHVybiB0aGlzLmR1dHlDaGFpbnMuc2xpY2UoLTEpWzBdXG4gIH1cblxuICBwdWJsaWMgZ2V0IHV0aWxzKCkge1xuICAgIHJldHVybiB7XG4gICAgICBwYWdpbmdMb2dpYzogKGdldERhdGEsIGdldENvdW50KSA9PiB7XG4gICAgICAgIHJldHVybiBhc3luYyAob2Zmc2V0LCBwYWdlU2l6ZSwgbmV4dCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhd2FpdCBwYWdpbmdMb2dpYyhnZXREYXRhLCBnZXRDb3VudCwgb2Zmc2V0LCBwYWdlU2l6ZSwgbmV4dClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBlbXB0eUNoYWluKCkge1xuICAgIHRoaXMuZHV0eUNoYWlucyA9IFtdXG4gIH1cblxuICBwdWJsaWMgbmV4dChoYW5kbGVyOiBGdW5jdGlvbikge1xuICAgIGNvbnN0IG5leHRDaGFpbiA9IG5ldyBEdXR5Q2hhaW4oaGFuZGxlcik7XG5cbiAgICBpZiAodGhpcy5oZWFkKSB7XG4gICAgICB0aGlzLmhlYWQuc2V0TmV4dChuZXh0Q2hhaW4pO1xuICAgIH1cbiAgICB0aGlzLmR1dHlDaGFpbnMucHVzaChuZXh0Q2hhaW4pO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc3RhcnQocGFnZUluZGV4LCBwYWdlU2l6ZSkge1xuICAgIGlmICghdGhpcy50YWlsKSB0aHJvdyBuZXcgRXJyb3IoJ2R1dHkgY2hhaW4gaXMgZW1wdHkhJyk7XG4gICAgY29uc3QgcmV0ID0gYXdhaXQgdGhpcy50YWlsLmhhbmRsZVJlcXVlc3QocGFnZUluZGV4LCBwYWdlU2l6ZSk7XG5cbiAgICByZXR1cm4gcmV0XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgbmV3IFBhZ2VTcGxpY2luZygpO1xuIl19